@using PatientPortal.DTOModel;
@using PatientPortal.Shared;
@model List<PatientPortal.DTOModel.SurveyQuestionAnswerDTO>
@{
    string baseHref = string.Empty, surveyName = string.Empty, ansIds = string.Empty, ansvalues = string.Empty;
    IList<IRecommendedProductDTO> recommendationList = (IList<IRecommendedProductDTO>)System.Web.HttpContext.Current.Session["RecommendedProductList"];
    if (recommendationList.Count > 0)
    {
        surveyName = recommendationList.FirstOrDefault().SurveyName;
    }
    List<PatientPortal.DTOModel.SurveyQuestionAnswerDTO> currentSurveyList = new List<SurveyQuestionAnswerDTO>();
    baseHref = System.Configuration.ConfigurationManager.AppSettings["BaseHref"];
    UserDetailDTO userDetails = (UserDetailDTO)System.Web.HttpContext.Current.Session["UserDetail"];
    int questId = 0, questionCounter = 0, questionPerpage = 0;
    foreach (SurveyQuestionAnswerDTO dto in Model)
    {
        bool isUnique = true;
        foreach (SurveyQuestionAnswerDTO arrayDTO in currentSurveyList.OrderBy(c => c.QuestionId))
        {
            if (dto.QuestionId == arrayDTO.QuestionId)
            {
                isUnique = false;
                questId = dto.QuestionId;
                ansIds = dto.AnswerId.Value.ToString();
                ansvalues = dto.TextInput;
                ansIds = ansIds.ToString() + ',' + arrayDTO.AnswerIds.ToString();
                if (ansvalues != "")
                {
                    ansvalues = ansvalues + ',' + arrayDTO.TextInput;
                }
            }
        }

        if (!isUnique)
        {
            foreach (SurveyQuestionAnswerDTO arrayDTO in currentSurveyList)
            {
                if (arrayDTO.QuestionId == questId)
                {
                    arrayDTO.AnswerIds = ansIds;
                    arrayDTO.TextInput = ansvalues;
                }
            }
        }

        if (isUnique)
        {
            dto.AnswerIds = dto.AnswerId.ToString();
            currentSurveyList.Add(dto);
        }
    }
}
@{
    ViewBag.Title = "SurveyResult";
    Layout = null;
}

<html lang="en" style="margin:0; padding:0;">
<head>
    <meta charset="utf-8">
    <title>::: Assa Abloy :::</title>
</head>
<body style="margin:0; padding:0; border:0; font-family: arial; font-size: 16px; text-align:justify;">
    <table cellpadding="0" cellspacing="15" border="0" width="100%">
        @{
            <tr>
                <td>
                    <table cellpadding="0" cellspacing="0" border="0" width="100%">
                        <tr>
                            <td><img src="@(baseHref)Contents/images/logo.png" style="width:112px; height:112px;" /></td>
                        </tr>
                        <tr>
                            <td><h2 style="font-size:42px; margin:30px 0 30px 0; padding:0 0 8px 0; display:inline-block; background:url('@(baseHref)Contents/images/down-arrow.png') no-repeat right bottom;"><span style="border-bottom:7px solid #ffd402; display:inline-block;  padding:0 20px 20px 0; line-height:30px;">@surveyName</span></h2></td>
                        </tr>
                    </table>
                </td>

            </tr>
            <tr>
                <td>
                    <table cellspacing="0" cellpadding="0" border="0">
                        <tr>
                            <td width="150" style="padding:5px 0;">Full Name :</td>
                            <td style="padding:5px 0;">@userDetails.FirstName @(" ") @userDetails.LastName</td>
                        </tr>
                        <tr>
                            <td style="padding:5px 0;">Business Name :</td>
                            <td style="padding:5px 0;">@userDetails.BusinessName</td>
                        </tr>
                        <tr>
                            <td style="padding:5px 0;">Phone Number :</td>
                            <td style="padding:5px 0;">@userDetails.PhoneNumber</td>
                        </tr>
                        <tr>
                            <td style="padding:5px 0;">Email Id :</td>
                            <td style="padding:5px 0;">@userDetails.EmailId</td>
                        </tr>
                        @*<tr>
                                <td style="padding:5px 0;">State :</td>
                                <td style="padding:5px 0;">@userDetails.StateName</td>
                            </tr>*@
                        <tr>
                            <td style="padding:5px 0;">Zip Code :</td>
                            <td style="padding:5px 0;">@userDetails.ZipCode</td>
                        </tr>
                    </table>
                </td>
            </tr>
            foreach (SurveyQuestionAnswerDTO question in currentSurveyList)
            {

                string answerTDWidth = string.Empty, tdImageHeight = string.Empty, answerIds = string.Empty;
                int answerCounter = 0;
                answerTDWidth = question.IQuestionDTO.IAnswerDTOList.Count > 4 ? "16.66666667%" : "25%";
                tdImageHeight = question.IQuestionDTO.IAnswerDTOList.Count > 4 ? "130" : "210";
                answerIds = string.IsNullOrEmpty(question.AnswerIds) ? question.AnswerId.ToString() : question.AnswerIds;
                <tr>
                    <!-- Repeat TR For Question and Answer -->
                    <td>
                        @if (questionPerpage == 2)
                        {
                            <p style="page-break-after:always;"></p>
                            questionPerpage = 0;
                        }
                        <table cellpadding="0" cellspacing="0" border="0" width="100%">
                            <tr>
                                <!-- Question TR -->
                                <td style=" font-size: 28px; line-height: 32px; padding-bottom: 10px; padding-top: 10px;">
                                    @question.IQuestionDTO.Title
                                </td>
                            </tr><!-- Question TR End -->
                            <tr>
                                <!-- Answer TR -->
                                <td>
                                    <table cellpadding="0" cellspacing="0" border="0" width="100%">
                                        <tr>
                                            @foreach (AnswerDTO answer in question.IQuestionDTO.IAnswerDTOList)
                                            {
                                                string answerImagePath = string.Empty;
                                                answerImagePath = string.IsNullOrEmpty(answer.ImagePath) ? (baseHref + "Contents/images/prod-img1.png") : (baseHref + answer.ImagePath);

                                                <!-- Repeat TD for Answers -->
                                                if (question.IQuestionDTO.IQuestionTypeDTO.Type == "Number-Slider")
                                                {
                                                        <!-- Answer TR -->
                                                    <td>
                                                        @answer.Title
                                                    </td>
                                                }
                                                else if (question.IQuestionDTO.IQuestionTypeDTO.Type == "Multi-Select")
                                                {
                                                    string checkUncheckedImagePath = string.Empty;
                                                    string[] splitAnswerIds = answerIds.Split(',');
                                                    checkUncheckedImagePath = baseHref + "Contents/images/uncheck.jpg";
                                                    foreach (string answerId in splitAnswerIds)
                                                    {
                                                        if (answer.Id == Convert.ToInt32(answerId))
                                                        {
                                                            checkUncheckedImagePath = baseHref + "Contents/images/checked.jpg";
                                                        }
                                                    }

                                                    <div style="width: @answerTDWidth; float: left;">
                                                        <div style="padding:0 10px 0 0;">
                                                            <div style="padding: 10px 0; height:50px;"><img src="@checkUncheckedImagePath" /></div>
                                                            <div style="background: #eee; padding: 10px; border: 1px solid #bfbdbd; height: @tdImageHeight"><img src="@answerImagePath" style="width:100%; height:auto;" /></div>
                                                            <div style="font-size:12px;"><div style="background:#eee; padding:10px; margin-top:10px;">@answer.Title</div></div>
                                                        </div>
                                                    </div>
                                                }
                                                else if (question.IQuestionDTO.IQuestionTypeDTO.Type == "Single-Select")
                                                {
                                                    string checkUncheckedImagePath = string.Empty;
                                                    checkUncheckedImagePath = question.AnswerId == answer.Id ? baseHref + "Contents/images/radio-checked.jpg" : baseHref + "Contents/images/radio-unchecked.jpg";

                                                    <div style="width: @answerTDWidth; float: left;">
                                                        <div style="padding:0 10px 0 0;">
                                                            <div style="padding: 10px 0; height: 50px;"><img src="@checkUncheckedImagePath" /></div>

                                                            <div>@answer.Title</div>
                                                        </div>
                                                    </div>
                                                }
                                                else
                                                {
                                                    string[] splitAnswerIds = question.AnswerIds.Split(',');
                                                    Array.Reverse(splitAnswerIds);
                                                    string[] textInputs = question.TextInput.Split(',');
                                                    Array.Reverse(textInputs);
                                                    string currentAnswerValue = string.Empty;

                                                    foreach (string answerId in splitAnswerIds)
                                                    {
                                                        if (answer.Id == Convert.ToInt32(answerId))
                                                        {
                                                            currentAnswerValue = textInputs[answerCounter];
                                                            answerCounter++;
                                                        }

                                                    }

                                                    <div style="width: @answerTDWidth; float: left;">
                                                        <div style="padding:0 10px 0 0;">

                                                            <div style="background: #eee; padding: 10px; border: 1px solid #bfbdbd; height: @tdImageHeight"><img src="@answerImagePath" style="width:100%; height:auto;" /></div>

                                                            @if (question.IQuestionDTO.IQuestionTypeDTO.Type == "TextBox")
                                                            {
                                                                <div style="font-size:12px;"><div style="margin-top:10px;"><input style="width:100%" type="text" value="@currentAnswerValue" />  </div></div>
                                                            }
                                                            else if (question.IQuestionDTO.IQuestionTypeDTO.Type == "TextArea")
                                                            {
                                                                <div style="font-size:12px;"><div style="margin-top:10px;"><textarea style="width:100%" name="TextArea" value="@currentAnswerValue"></textarea> </div></div>
                                                            }

                                                            <div style="font-size:12px;"><div style="background:#eee; padding:10px; margin-top:10px;">@answer.Title</div></div>
                                                        </div>
                                                    </div>
                                                }
                                            }
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>

                    </td>
                </tr><!-- Repeat TR For Question and Answer End-->

                if (currentSurveyList.Count < (questionCounter + 1))
                {
                    <tr>
                        <!-- Tr for Margin between Questions -->
                        <td height="50"> &nbsp; </td>
                    </tr>
                }

                questionCounter++;
                questionPerpage++;
            }
        }
    </table>
</body>
</html>